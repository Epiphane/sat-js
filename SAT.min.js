!function(t,e){"use strict";"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.SAT=e()}(this,function(){"use strict";function t(t,e){this.x=t||0,this.y=e||0}function e(e,r){this.pos=e||new t,this.r=r||0}function r(e,r){this.pos=e||new t,this.angle=0,this.offset=new t,this.setPoints(r||[])}function o(e,r,o){this.pos=e||new t,this.w=r||0,this.h=o||0}function n(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.clear()}function s(t,e,r){for(var o=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=t.length,i=0;s>i;i++){var p=t[i].dot(e);o>p&&(o=p),p>n&&(n=p)}r[0]=o,r[1]=n}function i(t,e,r,o,n,i){var p=v.pop(),a=v.pop(),l=e.sub(t),h=l.dot(n);if(s(r,n,p),s(o,n,a),a[0]+=h,a[1]+=h,p[0]>a[1]||a[0]>p[1])return v.push(p),v.push(a),!0;if(i){var u=0;if(p[0]<a[0])if(i.aInB=!1,p[1]<a[1])u=p[1]-a[0],i.bInA=!1;else{var c=p[1]-a[0],f=a[1]-p[0];u=f>c?c:-f}else if(i.bInA=!1,p[1]>a[1])u=p[0]-a[1],i.aInB=!1;else{var c=p[1]-a[0],f=a[1]-p[0];u=f>c?c:-f}var y=Math.abs(u);y<i.overlap&&(i.overlap=y,i.overlapN=n,0>u&&i.overlapN.reverse())}return v.push(p),v.push(a),!1}function p(t,e){var r=t.len2(),o=e.dot(t);return 0>o?x:o>r?d:A}function a(t,e){var r=t.sub(e.pos),o=e.r*e.r,n=r.len2();return o>=n}function l(t,e){w.pos=t,g.clear();var r=f(w,e,g);return r&&(r=g.aInB),r}function h(t,e,r){var o=e.pos.sub(t.pos),n=t.r+e.r,s=n*n,i=o.len2();if(i>s)return!1;if(r){var p=Math.sqrt(i);r.a=t,r.b=e,r.overlap=n-p,r.overlapN=o.normalize(),r.overlapV=r.overlapN.scale(r.overlap),r.aInB=t.r<=e.r&&p<=e.r-t.r,r.bInA=e.r<=t.r&&p<=t.r-e.r}return!0}function u(t,e,r){for(var o,n,s=e.pos.sub(t.pos),i=e.r,a=i*i,l=t.calcPoints,h=l.length,u=0;h>u;u++){var c=u===h-1?0:u+1,f=0===u?h-1:u-1,y=0,v=null;o=t.edges[u],n=s.sub(l[u]),r&&n.len2()>a&&(r.aInB=!1);var b=p(o,n);if(b===x){o=t.edges[f];var g=s.sub(l[f]);if(b=p(o,g),b===d){var w=n.len();if(w>i)return!1;r&&(r.bInA=!1,v=n.normalize(),y=i-w)}}else if(b===d){if(o=t.edges[c],n=s.sub(l[c]),b=p(o,n),b===x){var w=n.len();if(w>i)return!1;r&&(r.bInA=!1,v=n.normalize(),y=i-w)}}else{var A=o.perp().normalize(),w=n.dot(A),P=Math.abs(w);if(w>0&&P>i)return!1;r&&(v=A,y=i-w,(w>=0||2*i>y)&&(r.bInA=!1))}v&&r&&Math.abs(y)<Math.abs(r.overlap)&&(r.overlap=y,r.overlapN=v)}return r&&(r.a=t,r.b=e,r.overlapV=r.overlapN.scale(r.overlap)),!0}function c(t,e,r){var o=u(e,t,r);if(o&&r){var n=r.a,s=r.aInB;r.overlapN.reverse(),r.overlapV.reverse(),r.a=r.b,r.b=n,r.aInB=r.bInA,r.bInA=s}return o}function f(t,e,r){for(var o=t.calcPoints,n=o.length,s=e.calcPoints,p=s.length,a=0;n>a;a++)if(i(t.pos,e.pos,o,s,t.normals[a],r))return!1;for(var a=0;p>a;a++)if(i(t.pos,e.pos,o,s,e.normals[a],r))return!1;return r&&(r.a=t,r.b=e,r.overlapV=r.overlapN.scale(r.overlap)),!0}var y={};y.Vector=t,y.V=t,t.prototype.perp=t.prototype.perp=function(){return new t(this.y,-this.x)},t.prototype.rotate=t.prototype.rotate=function(e){return new t(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))},t.prototype.reverse=t.prototype.reverse=function(){return new t(-this.x,-this.y)},t.prototype.normalize=t.prototype.normalize=function(){var e=this.len();return e>0?new t(this.x/e,this.y/e):this},t.prototype.add=t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.scale=t.prototype.scale=function(e,r){return new t(this.x*e,this.y*(r||e))},t.prototype.project=t.prototype.project=function(e){var r=this.dot(e)/e.len2();return new t(r*e.x,r*e.y)},t.prototype.projectN=t.prototype.projectN=function(e){var r=this.dot(e);return new t(r*e.x,r*e.y)},t.prototype.reflect=t.prototype.reflect=function(e){return this.project(e).scale(2).sub(new t(this.x,this.y))},t.prototype.reflectN=t.prototype.reflectN=function(e){return this.projectN(e).scale(2).sub(new t(this.x,this.y))},t.prototype.dot=t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len2=t.prototype.len2=function(){return this.dot(this)},t.prototype.len=t.prototype.len=function(){return Math.sqrt(this.len2())},y.Circle=e,e.prototype.getAABB=e.prototype.getAABB=function(){var e=this.r,r=this.pos.sub(new t(e,e));return new o(r,2*e,2*e).toPolygon()},y.Polygon=r,r.prototype.setPoints=r.prototype.setPoints=function(e){var r=!this.points||this.points.length!==e.length;if(r){var o,n=this.calcPoints=[],s=this.edges=[],i=this.normals=[];for(o=0;o<e.length;o++)n.push(new t),s.push(new t),i.push(new t)}return this.points=e,this._recalc(),this},r.prototype.setAngle=r.prototype.setAngle=function(t){return this.angle=t,this._recalc(),this},r.prototype.setOffset=r.prototype.setOffset=function(t){return this.offset=t,this._recalc(),this},r.prototype.rotate=r.prototype.rotate=function(t){for(var e=this.points,r=e.length,o=0;r>o;o++)e[o].rotate(t);return this._recalc(),this},r.prototype.translate=r.prototype.translate=function(t,e){for(var r=this.points,o=r.length,n=0;o>n;n++)r[n].x+=t,r[n].y+=e;return this._recalc(),this},r.prototype._recalc=function(){var t,e=this.calcPoints,r=this.edges,o=this.normals,n=this.points,s=this.offset,i=this.angle,p=n.length;for(t=0;p>t;t++){var a=e[t]=n[t];a.x+=s.x,a.y+=s.y,0!==i&&(e[t]=a.rotate(i))}for(t=0;p>t;t++){var l=e[t],h=p-1>t?e[t+1]:e[0],u=r[t]=h.sub(l);o[t]=u.perp().normalize()}return this},r.prototype.getAABB=r.prototype.getAABB=function(){for(var e=this.calcPoints,r=e.length,n=e[0].x,s=e[0].y,i=e[0].x,p=e[0].y,a=1;r>a;a++){var l=e[a];l.x<n?n=l.x:l.x>i&&(i=l.x),l.y<s?s=l.y:l.y>p&&(p=l.y)}return new o(this.pos.add(new t(n,s)),i-n,p-s).toPolygon()},y.Box=o,o.prototype.toPolygon=o.prototype.toPolygon=function(){var e=this.pos,o=this.w,n=this.h;return new r(new t(e.x,e.y),[new t,new t(o,0),new t(o,n),new t(0,n)])},y.Response=n,n.prototype.clear=n.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var v=[],b=0;5>b;b++)v.push([]);var g=new n,w=new o(new t,1,1).toPolygon(),x=-1,A=0,d=1;return y.pointInCircle=a,y.pointInPolygon=l,y.testCircleCircle=h,y.testPolygonCircle=u,y.testCirclePolygon=c,y.testPolygonPolygon=f,y});